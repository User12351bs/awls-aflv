<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favoritos - Ureshii Anime</title>
    <link rel="stylesheet" href="index.css">
    <link rel="icon" href="logo.png" type="image/x-icon">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ureshii Anime">
    <script src="glob/localstorage.js"></script>
    <script src="animes.js"></script>
    <link rel="stylesheet" href="glob/header.css">
    <script src="glob/header.js"></script>
    <link rel="stylesheet" href="glob/cards.css">
    <script src="glob/cards.js"></script>

    <style>
        .title-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px !important;
            margin-top: 30px !important; /* Añadir margen superior fijo */
        }
        
        .title-icon {
            margin-right: 10px;
            width: 30px;
            height: 30px;
            fill: white; /* Hacer el SVG de color blanco */
            position: relative;
            top: -12px !important; /* Ajustar verticalmente el SVG con el título */
        }
        
        /* Quitar negrita del título y hacerlo más grande */
        h2.section-title {
            font-weight: normal;
            font-size: 28px; /* Hacer el título más grande */
        }
        
        
        /* Estilos para el selector horizontal */
        .tab-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            border-bottom: 1px solid var(--secondary-color);
        }
        
        .tab-button {
            background-color: transparent;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 12px 20px;
            font-size: 16px;
            color: var(--text-color);
            position: relative;
            transition: all 0.3s ease;
            font-weight: normal; /* Quitar negrita de los botones */
            text-transform: uppercase; /* Mantener mayúsculas sin distorsión */
        }
        
        .tab-button:hover {
            color: var(--accent-color);
        }
        
        .tab-button.active {
            color: var(--accent-color);
            font-weight: normal; /* Quitar negrita incluso cuando está activo */
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--accent-color);
            border-radius: 3px 3px 0 0;
        }
        
        /* Contenedores para las diferentes secciones */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        
        /* Añadir esta regla para cuando el grid contiene mensajes de error */
        .anime-grid.empty-results {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }
        
        /* Estilo para el mensaje cuando no hay favoritos */
        .empty-message {
            text-align: center;
            padding: 2rem 1rem 0.5rem 1rem;
            color: #aaa;
            font-size: 1.2rem;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: block;
            line-height: 1.4;
            min-height: auto;
            background-color: transparent;
            border-radius: 0;
        }
        
        /* Estilo para el mensaje de eliminado de favoritos */
        .removed-message {
            text-align: center;
            padding: 1rem;
            color: var(--accent-color);
            font-size: 1.1rem;
            width: 100%;
            max-width: 600px;
            margin: 0 auto 1rem auto;
            display: none; /* Oculto por defecto */
            line-height: 1.4;
            background-color: rgba(255, 69, 58, 0.1);
            border-radius: 8px;
            animation: fadeOut 3s forwards;
            animation-delay: 2s;
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; display: none; }
        }
        
        /* Estilos para resoluciones grandes */
        @media (min-width: 1600px) {
            /* Aumentar tamaño del título principal */
            h2.section-title {
                font-size: 42px !important; /* Forzar con !important */
            }
            
            /* Aumentar tamaño del icono del título */
            .title-icon {
                width: 45px !important; /* Forzar con !important */
                height: 45px !important; /* Forzar con !important */
                top: -18px !important; /* Forzar con !important */
                margin-right: 15px !important; /* Forzar con !important */
            }
            
            /* Aumentar tamaño de los botones de pestañas (selector URESHIILISTS/FAVORITOS) */
            .tab-button {
                font-size: 28px !important; /* Forzar con !important */
                padding: 20px 35px !important; /* Forzar con !important */
                font-weight: 500 !important; /* Forzar con !important */
            }
            
            /* Aumentar el grosor de la línea indicadora de pestaña activa */
            .tab-button.active::after {
                height: 5px !important; /* Forzar con !important */
            }
            
            /* Aumentar tamaño de los mensajes vacíos */
            .empty-message {
                font-size: 1.6rem;
                max-width: 800px;
                padding: 2.5rem 1.5rem 1rem 1.5rem;
            }
            
            /* Aumentar tamaño de los mensajes de eliminado */
            .removed-message {
                font-size: 1.4rem;
                max-width: 800px;
                padding: 1.5rem;
            }
            
            /* Aumentar el espacio entre elementos del grid */
            .anime-grid {
                gap: 15px;
                padding: 0 30px;
            }
            
            /* Ajustar el tamaño del contenedor cuando está vacío */
            .anime-grid.empty-results {
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="menu-button" id="menu-toggle">
            <svg class="menu-ab-svg--wDGx3 header-svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-t="menu-svg" aria-hidden="true" role="img"><path class="menu-ab-svg__top--Xgjtj" d="M20 5H4V7H20V5Z"></path><path class="menu-ab-svg__middle--vsB5D" d="M4 11H20V13H4V11Z"></path><path class="menu-ab-svg__bottom--6yklx" d="M20 17H4V19H20V17Z"></path></svg>
        </div>
        <a href="index.html" class="header-logo">
            <picture>
                <source media="(max-width: 768px)" srcset="logo.png">
                <source media="(min-width: 769px)" srcset="horizontal-logo.png">
                <img src="horizontal-logo.png" alt="Ureshii Anime" class="logo-img">
            </picture>
        </a>
        <div class="nav-categories">
            <a href="index.html" class="nav-category">Catálogo</a>
            <a href="novedades.html" class="nav-category">Novedades</a>
        </div>
        <div class="header-buttons">
            <a href="search.html" class="header-button">
                <svg class="header-svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-t="search-svg" aria-hidden="true" role="img"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5 19C12.4879 19 14.3164 18.3176 15.7641 17.1742L21.2927 22.7069L22.7074 21.2931L17.1778 15.7595C18.319 14.3126 19 12.4858 19 10.5C19 5.80558 15.1944 2 10.5 2C5.80558 2 2 5.80558 2 10.5C2 15.1944 5.80558 19 10.5 19ZM10.5 17C14.0899 17 17 14.0899 17 10.5C17 6.91015 14.0899 4 10.5 4C6.91015 4 4 6.91015 4 10.5C4 14.0899 6.91015 17 10.5 17Z"></path></svg>
            </a>
            <a href="ureshiilists.html" class="header-button">
                <svg class="header-svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-t="watchlist-svg" aria-hidden="true" role="img"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.0001 20.5858C19.0001 21.4767 17.9229 21.9229 17.293 21.2929L12.0001 16L6.7071 21.2929C6.07714 21.9229 5 21.4767 5 20.5858L5.00006 3H19.0001V20.5858ZM7.00001 18.1716L7.00006 5H17.0001V18.1716L12.0001 13.1716L7.00001 18.1716Z"></path></svg>
            </a>
            <a href="account.html" class="export-button" id="export-import-button">
                <svg class="header-svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-t="user-settings-svg" aria-hidden="true" role="img"><path d="M12 20a6.01 6.01 0 0 1-5.966-5.355L12 12.088l5.966 2.557A6.01 6.01 0 0 1 12 20m0-16c1.654 0 3 1.346 3 3s-1.345 3-2.999 3h-.002A3.003 3.003 0 0 1 9 7c0-1.654 1.346-3 3-3m7.394 9.081l-4.572-1.959A4.997 4.997 0 0 0 17 7c0-2.757-2.243-5-5-5S7 4.243 7 7c0 1.71.865 3.22 2.178 4.122l-4.572 1.959A.999.999 0 0 0 4 14c0 4.411 3.589 8 8 8s8-3.589 8-8c0-.4-.238-.762-.606-.919"></path></svg>
            </a>
        </div>
    </header>

    <div class="container">
        <!-- Título centrado con SVG de "añadir a la lista" (versión vacía) -->
        <div class="title-container">
            <svg class="title-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-t="watchlist-svg" aria-hidden="true" role="img">
                <path d="M17 18.113l-3.256-2.326A2.989 2.989 0 0 0 12 15.228c-.629 0-1.232.194-1.744.559L7 18.113V4h10v14.113zM18 2H6a1 1 0 0 0-1 1v17.056c0 .209.065.412.187.581a.994.994 0 0 0 1.394.233l4.838-3.455a1 1 0 0 1 1.162 0l4.838 3.455A1 1 0 0 0 19 20.056V3a1 1 0 0 0-1-1z"></path>
            </svg>
            <h2 class="section-title">Mis Listas</h2>
        </div>
        
        <!-- Selector horizontal para FAVORITOS y URESHIILISTS -->
        <div class="tab-selector">
            <a href="ureshiilists.html" class="tab-button" style="text-decoration: none !important;">URESHIILISTS</a>
            <button class="tab-button active" data-tab="favorites">FAVORITOS</button>
        </div>
        
        <!-- Contenido de las pestañas -->
        <div id="favorites" class="tab-content active">
            <div class="anime-grid" id="favorites-grid"></div>
        </div>
        
        <div id="mylist" class="tab-content active">
            <div class="anime-grid" id="anime-grid"></div>
        </div>
        
        <div id="favorites" class="tab-content">
            <div class="anime-grid" id="favorites-grid"></div>
        </div>
    </div>

    <!-- Modal para exportar/importar datos -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-content-container"></div>
        </div>
    </div>

    <div id="favorites-notification" class="favorites-notification">
        <div class="favorites-notification-content">
            Se ha eliminado de favoritos correctamente
        </div>
    </div>

    <script>
        // Usar window.myList y window.favorites en lugar de redeclarar
        const watchedEpisodes = JSON.parse(localStorage.getItem(WATCHED_EPISODES_KEY)) || {};
        const watchingAnimes = JSON.parse(localStorage.getItem(WATCHING_ANIMES_KEY)) || [];

        animeData.forEach(anime => {
            anime.inMyList = window.myList.includes(anime.id);
            anime.inFavorites = window.favorites.includes(anime.id);
        });
        
        // Función para mostrar los animes en la página
        function displayAnimes() {
            // Actualizar episodios lanzados antes de mostrar los animes
            window.updateReleasedEpisodes();
            
            // Mostrar animes en Favoritos
            const favoritesGrid = document.getElementById('favorites-grid');
            favoritesGrid.innerHTML = ''; // Limpiar el grid
            
            // Filtrar solo los animes en favoritos
            const favoriteAnimes = animeData.filter(anime => window.favorites.includes(anime.id));
            
            if (favoriteAnimes.length === 0) {
                // Cambiar la clase del grid para usar flex en lugar de grid
                favoritesGrid.className = 'anime-grid empty-results';
                
                // Mostrar mensaje si no hay animes en favoritos
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'empty-message';
                // Añadir el SVG grande encima del texto
                const emptySvg = document.createElement('div');
                emptySvg.innerHTML = `
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-t="error-svg" aria-hidden="true" role="img" style="width: 120px; height: 120px; margin-bottom: 20px; fill: #aaa;">
                        <path d="M12.049 17.984l.9 2.7a.999.999 0 0 1-.95 1.317c-.418 0-.808-.265-.948-.684l-.9-2.7a1.847 1.847 0 0 0-2.334-1.168l-2.701.9a1 1 0 0 1-.632-1.897l2.7-.9a3.85 3.85 0 0 1 4.865 2.432zm9.9-6.3a1 1 0 0 1-.632 1.265l-2.701.9a1.848 1.848 0 0 0-1.167 2.335l.9 2.7a.999.999 0 0 1-.95 1.317c-.418 0-.808-.265-.948-.684l-.9-2.7a3.85 3.85 0 0 1 2.433-4.865l2.7-.9a.998.998 0 0 1 1.265.632zm-13.5-4.5a3.85 3.85 0 0 1-2.432 4.865l-2.7.9a.999.999 0 0 1-1.265-.632.999.999 0 0 1 .632-1.265l2.7-.9a1.85 1.85 0 0 0 1.168-2.335l-.9-2.7a1 1 0 1 1 1.897-.633l.9 2.7zm3.502-1.167l-.9-2.7a.999.999 0 0 1 .632-1.265 1 1 0 0 1 1.266.632l.9 2.7a1.85 1.85 0 0 0 2.334 1.168l2.701-.9a1 1 0 0 1 .632 1.897l-2.7.9a3.832 3.832 0 0 1-1.213.198 3.854 3.854 0 0 1-3.652-2.63z"></path>
                    </svg>
                `;
                
                emptyMessage.appendChild(emptySvg);
                
                // Añadir el texto del mensaje después del SVG
                const messageText = document.createElement('div');
                messageText.innerHTML = 'No tienes animes en favoritos.<br>Añade algunos desde el catálogo.';
                
                emptyMessage.appendChild(messageText);
                favoritesGrid.appendChild(emptyMessage);
            } else {
                // Asegurarse de que el grid tenga la clase correcta cuando hay resultados
                favoritesGrid.className = 'anime-grid';
                
                // Crear y añadir las tarjetas de anime
                favoriteAnimes.forEach(anime => {
                    const card = createAnimeCard(anime);
                    favoritesGrid.appendChild(card);
                });
            }
        }
        
        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            displayAnimes();
            
            // Configurar el modal de exportar/importar
            const modal = document.getElementById('modal');
            const exportImportButton = document.getElementById('export-import-button');
            const closeButton = document.querySelector('.close');
            const modalContentContainer = document.getElementById('modal-content-container');
            
            // Abrir modal al hacer clic en el botón de exportar/importar
            exportImportButton.addEventListener('click', function() {
                // Crear contenido del modal
                modalContentContainer.innerHTML = `
                    <div class="export-import-container">
                        <div class="export-section">
                            <h2>Exportar Datos</h2>
                            <p>Copia el siguiente código para guardar tus datos:</p>
                            <textarea id="export-data" readonly rows="5" class="export-textarea"></textarea>
                            <button id="copy-button" class="action-button">Copiar al Portapapeles</button>
                        </div>
                        <div class="import-section">
                            <h2>Importar Datos</h2>
                            <p>Pega tu código de datos aquí:</p>
                            <textarea id="import-data" rows="5" class="import-textarea" placeholder="Pega aquí tu código..."></textarea>
                            <button id="import-button" class="action-button">Importar Datos</button>
                        </div>
                    </div>
                `;
                
                // Generar y mostrar los datos de exportación
                const exportData = {
                    watchedEpisodes: watchedEpisodes,
                    watchingAnimes: watchingAnimes,
                    myList: myList,
                    favorites: favorites
                };
                
                document.getElementById('export-data').value = JSON.stringify(exportData);
                
                // Configurar el botón de copiar
                document.getElementById('copy-button').addEventListener('click', function() {
                    const exportTextarea = document.getElementById('export-data');
                    exportTextarea.select();
                    document.execCommand('copy');
                    this.textContent = '¡Copiado!';
                    setTimeout(() => { this.textContent = 'Copiar al Portapapeles'; }, 2000);
                });
                
                // Configurar el botón de importar
                document.getElementById('import-button').addEventListener('click', function() {
                    const importData = document.getElementById('import-data').value;
                    try {
                        const data = JSON.parse(importData);
                        
                        // Validar que los datos tengan la estructura correcta
                        if (data.watchedEpisodes && data.watchingAnimes && data.myList) {
                            // Actualizar los datos locales
                            Object.assign(watchedEpisodes, data.watchedEpisodes);
                            watchingAnimes.length = 0;
                            watchingAnimes.push(...data.watchingAnimes);
                            myList.length = 0;
                            myList.push(...data.myList);
                            
                            // Actualizar favoritos si existen en los datos importados
                            if (data.favorites) {
                                favorites.length = 0;
                                favorites.push(...data.favorites);
                            }
                            
                            // Guardar en localStorage
                            localStorage.setItem(WATCHED_EPISODES_KEY, JSON.stringify(watchedEpisodes));
                            localStorage.setItem(WATCHING_ANIMES_KEY, JSON.stringify(watchingAnimes));
                            localStorage.setItem(MY_LIST_KEY, JSON.stringify(myList));
                            localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
                            
                            // Actualizar la interfaz
                            animeData.forEach(anime => {
                                anime.inMyList = myList.includes(anime.id);
                                anime.inFavorites = favorites.includes(anime.id);
                            });
                            
                            displayAnimes();
                            
                            this.textContent = '¡Importado con éxito!';
                            setTimeout(() => { this.textContent = 'Importar Datos'; }, 2000);
                        } else {
                            throw new Error('Formato de datos inválido');
                        }
                    } catch (error) {
                        alert('Error al importar datos. Asegúrate de que el formato es correcto.');
                        console.error('Error al importar:', error);
                    }
                });
                
                modal.style.display = 'block';
            });
            
            // Cerrar modal al hacer clic en la X
            closeButton.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Cerrar modal al hacer clic fuera del contenido
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Cargar datos desde Google Drive si está disponible
            if (typeof window.loadInitialDataFromDrive === 'function') {
                window.loadInitialDataFromDrive();
            }
            
            // Escuchar cuando los datos de Drive estén listos
            window.addEventListener('driveDataReady', function(event) {
                console.log('Datos de Google Drive cargados en watchlist.html:', event.detail);
                // Recargar contenido que dependa de los datos
                if (typeof displayWatchlist === 'function') {
                    displayWatchlist();
                }
            });
        });
    </script>
</body>
</html>
